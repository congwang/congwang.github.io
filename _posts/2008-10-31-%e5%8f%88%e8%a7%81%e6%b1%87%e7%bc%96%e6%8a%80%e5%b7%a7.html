---
categories:
- Programming
date: 2008-10-31 23:08:18-07:00
layout: post
permalink: /2008/10/31/%e5%8f%88%e8%a7%81%e6%b1%87%e7%bc%96%e6%8a%80%e5%b7%a7/
title: 又见汇编技巧
---
<p><br />

<p>在 arch/x86/include/asm/uaccess.h 中有这么一段代码：</p>
<p>#define __range_not_ok(addr, size)                                     <br />
({                                                                     <br />
unsigned long flag, roksum;                                    <br />
__chk_user_ptr(addr);                                          <br />
asm("add %3,%1 ; sbb %0,%0 ; cmp %1,%4 ; sbb $0,%0"            <br />
: "=&amp;r" (flag), "=r" (roksum)                              <br />
: "1" (addr), "g" ((long)(size)),                          <br />
"rm" (current_thread_info()-&gt;addr_limit.seg));           <br />
flag;                                                          <br />
})</p>
<p>这段汇编写得很有技巧性，充分利用了<a href="http://www3.itu.edu.tr/~kesgin/mul06/intel/instr/sbb.html" target="_blank">sbb指令</a>和<a href="http://en.wikipedia.org/wiki/Carry_flag" target="_blank">carry flag</a>，值得你仔细体会一番。还有一个关于sbb的技巧：</p>
<p><em class="quotelev2">sbb  eax,eax </em><br />
<em class="quotelev2">sbb  eax,0FFFFFFFFh </em></p>
<p></p>