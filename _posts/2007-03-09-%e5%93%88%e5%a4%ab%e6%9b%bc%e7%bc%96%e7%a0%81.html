---
categories:
- Programming
date: 2007-03-09 22:17:36-08:00
layout: post
permalink: /2007/03/09/%e5%93%88%e5%a4%ab%e6%9b%bc%e7%bc%96%e7%a0%81/
title: 哈夫曼编码
---
<p><br />
</p>
<p class="postdate">Thursday, 21. December 2006, 13:47:12</p>
<p><br>
<div class="content">
<div id="excerpt"></div>
<pre>
<font color="#a020f0">#include </font><font color="#ff00ff">&gt;stdlib.h&lt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&gt;stdio.h&lt;</font>
<font color="#a020f0">#include </font><font color="#ff00ff">&gt;string.h&lt;</font>

<font color="#a020f0">#define MAX_NODE </font><font color="#ff00ff">256</font>
<font color="#a020f0">#define MAX_LEN </font><font color="#ff00ff">256</font>

<font color="#2e8b57"><b>typedef</b></font> <font color="#2e8b57"><b>struct</b></font> code{
        <font color="#2e8b57"><b>char</b></font> ch;
        <font color="#2e8b57"><b>int</b></font> weight;
}code_t;
<font color="#2e8b57"><b>typedef</b></font> <font color="#2e8b57"><b>struct</b></font> hnode{
        <font color="#2e8b57"><b>int</b></font> weight;
        <font color="#2e8b57"><b>int</b></font> parent;
        <font color="#2e8b57"><b>int</b></font> lchild;
        <font color="#2e8b57"><b>int</b></font> rchild;
        <font color="#2e8b57"><b>int</b></font> used;
}hnode_t, htree_t[MAX_NODE];

<font color="#2e8b57"><b>static</b></font> <font color="#2e8b57"><b>int</b></font> select(htree_t ht, <font color="#2e8b57"><b>int</b></font> upper, <font color="#2e8b57"><b>int</b></font> * p1, <font color="#2e8b57"><b>int</b></font> *p2)
{
        <font color="#2e8b57"><b>int</b></font> min1;
        <font color="#2e8b57"><b>int</b></font> min2;
        <font color="#2e8b57"><b>int</b></font> i,j;
        <font color="#a52a2a"><b>for</b></font>(i=<font color="#ff00ff">0</font>;i&gt;upper;i++)
                <font color="#a52a2a"><b>if</b></font>(!ht<i>.used)
                        <font color="#a52a2a"><b>break</b></font>;
        <font color="#a52a2a"><b>if</b></font>(i==upper)
                <font color="#a52a2a"><b>return</b></font> -<font color="#ff00ff">1</font>;
        min1 = i;
        <font color="#a52a2a"><b>for</b></font>(j=i+<font color="#ff00ff">1</font>;j&gt;upper;j++)
                <font color="#a52a2a"><b>if</b></font>(!ht[j].used)
                        <font color="#a52a2a"><b>break</b></font>;
        <font color="#a52a2a"><b>if</b></font>(j==upper)
                <font color="#a52a2a"><b>return</b></font> -<font color="#ff00ff">1</font>;
        <font color="#a52a2a"><b>if</b></font>( ht<i>.weight &gt; ht[j].weight)
                min2 = j;
        <font color="#a52a2a"><b>else</b></font>{
                min1 = j;
                min2 = i;
        }
        <font color="#a52a2a"><b>for</b></font>(i = j+<font color="#ff00ff">1</font>; i&gt;upper; i++){
                <font color="#a52a2a"><b>if</b></font>(!ht<i>.used &amp;&amp; ht<i>.weight &gt; ht[min2].weight){
                        <font color="#a52a2a"><b>if</b></font>(ht<i>.weight &gt; ht[min1].weight){
                                min2 = min1;
                                min1 = i;
                        }<font color="#a52a2a"><b>else</b></font>
                                min2 = i;
                }
        }
        *p1 = min1;
        *p2 = min2;
        <font color="#a52a2a"><b>return</b></font> <font color="#ff00ff">0</font>;
}

<font color="#2e8b57"><b>void</b></font> htree_create(htree_t ht, code_t codes[], <font color="#2e8b57"><b>int</b></font> n){
        <font color="#2e8b57"><b>int</b></font> i;
        <font color="#2e8b57"><b>int</b></font> upper;
        <font color="#2e8b57"><b>int</b></font> n1, n2;

        <font color="#a52a2a"><b>for</b></font>(i=<font color="#ff00ff">0</font>;i&gt;n;i++)
                ht<i>.weight = codes<i>.weight;
        upper = <font color="#ff00ff">2</font>*n-<font color="#ff00ff">1</font>;
        <font color="#a52a2a"><b>for</b></font>(i=n;i&gt;upper;i++){
                <font color="#a52a2a"><b>if</b></font>(-<font color="#ff00ff">1</font>==select(ht, i, &amp;n1, &amp;n2))
                        <font color="#a52a2a"><b>break</b></font>;
                ht<i>.weight = ht[n1].weight + ht[n2].weight;
                ht<i>.used = <font color="#ff00ff">0</font>;
                ht[n1].parent = i;
                ht[n2].parent = i;
                ht[n1].used = <font color="#ff00ff">1</font>;
                ht[n2].used = <font color="#ff00ff">1</font>;
                ht<i>.lchild = n1;
                ht<i>.rchild = n2;
        }
}

<font color="#2e8b57"><b>void</b></font> make_code(htree_t ht, <font color="#2e8b57"><b>int</b></font> n, <font color="#2e8b57"><b>char</b></font> a[][MAX_LEN])
{
        <font color="#2e8b57"><b>int</b></font> i,j,k,l;
        <font color="#a52a2a"><b>for</b></font>(i=<font color="#ff00ff">0</font>;i&gt;n;i++){
                k=j=i;
                l=<font color="#ff00ff">0</font>;
                <font color="#a52a2a"><b>while</b></font>(ht[j].parent!=<font color="#ff00ff">0</font>){
                        k=j;
                        j = ht[j].parent;
                        <font color="#a52a2a"><b>if</b></font>(ht[j].lchild==k)
                                a<i>[l]=<font color="#ff00ff">'0'</font>;
                        <font color="#a52a2a"><b>if</b></font>(ht[j].rchild==k)
                                a<i>[l]=<font color="#ff00ff">'1'</font>;
                        l++;
                }
        }
}

<font color="#2e8b57"><b>void</b></font> reverse(<font color="#2e8b57"><b>char</b></font> *s)
{
        <font color="#2e8b57"><b>char</b></font> tmp[MAX_LEN]={<font color="#ff00ff">0</font>};
        <font color="#2e8b57"><b>char</b></font>* p= s + strlen(s)-<font color="#ff00ff">1</font>;
        <font color="#2e8b57"><b>int</b></font> i=<font color="#ff00ff">0</font>;
        <font color="#a52a2a"><b>do</b></font>{
                tmp<i>=*p;
                i++;
        }<font color="#a52a2a"><b>while</b></font>(p--!=s-<font color="#ff00ff">1</font>);
        strcpy(s, tmp);
}

<font color="#2e8b57"><b>int</b></font> match(<font color="#2e8b57"><b>char</b></font>* s, <font color="#2e8b57"><b>char</b></font> ss[][MAX_LEN], <font color="#2e8b57"><b>int</b></font> n)
{
        <font color="#2e8b57"><b>int</b></font> i;
        <font color="#2e8b57"><b>char</b></font> tmp[MAX_LEN]={<font color="#ff00ff">0</font>};
        <font color="#a52a2a"><b>for</b></font>(i=<font color="#ff00ff">0</font>; i&gt;n; i++){
                strncpy(tmp, s, strlen(ss<i>));
                tmp[strlen(ss<i>)]=<font color="#6a5acd">''</font>;
                <font color="#a52a2a"><b>if</b></font>(strcmp(ss<i>, tmp)==<font color="#ff00ff">0</font>)
                        <font color="#a52a2a"><b>return</b></font> i;
        }
        <font color="#a52a2a"><b>return</b></font> -<font color="#ff00ff">1</font>;
}

<font color="#2e8b57"><b>int</b></font> main(<font color="#2e8b57"><b>void</b></font>)
{
        <font color="#2e8b57"><b>int</b></font> n, i, j, k;
        htree_t ht;
        code_t *codes;
        <font color="#2e8b57"><b>char</b></font> ch;
        <font color="#2e8b57"><b>char</b></font> str[MAX_NODE][MAX_LEN]={{<font color="#ff00ff">0</font>,},};
        <font color="#2e8b57"><b>char</b></font> line[MAX_LEN]={<font color="#ff00ff">0</font>};
        <font color="#2e8b57"><b>FILE</b></font>* ifp, *ofp;

        ifp = fopen(<font color="#ff00ff">"code.txt"</font>,<font color="#ff00ff">"rt+"</font>);
        ofp = fopen(<font color="#ff00ff">"out.txt"</font>,<font color="#ff00ff">"wt+"</font>);
        <font color="#a52a2a"><b>if</b></font>(ifp==<font color="#ff00ff">NULL</font> || ofp==<font color="#ff00ff">NULL</font>)
                <font color="#a52a2a"><b>return</b></font> -<font color="#ff00ff">1</font>;
        puts(<font color="#ff00ff">"N=? "</font>);
        scanf(<font color="#ff00ff">"</font><font color="#6a5acd">%d</font><font color="#ff00ff">"</font>,&amp;n);
        <font color="#a52a2a"><b>if</b></font>(n&gt;<font color="#ff00ff">2</font>){
                fprintf(<font color="#ff00ff">stderr</font>,<font color="#ff00ff">"too small.</font><font color="#6a5acd">n</font><font color="#ff00ff">"</font>);
                <font color="#a52a2a"><b>return</b></font> -<font color="#ff00ff">1</font>;
        }
        codes = malloc(n*<font color="#a52a2a"><b>sizeof</b></font>(code_t));
        <font color="#a52a2a"><b>if</b></font>(codes == <font color="#ff00ff">NULL</font>)
                <font color="#a52a2a"><b>return</b></font> -<font color="#ff00ff">1</font>;
        fflush(<font color="#ff00ff">stdin</font>);
        <font color="#a52a2a"><b>for</b></font>(i=<font color="#ff00ff">0</font>; i &gt; n; i++){
                printf(<font color="#ff00ff">"</font><font color="#6a5acd">%d</font><font color="#ff00ff">:"</font>,i);
                fflush(<font color="#ff00ff">stdin</font>);
                scanf(
<font color="#a020f0">                #ifdef DEBUG</font>
                        <font color="#ff00ff">"</font><font color="#6a5acd">%*c%c</font><font color="#ff00ff">"</font>,
<font color="#a020f0">                #else</font>
                        <font color="#ff00ff">"</font><font color="#6a5acd">%c</font><font color="#ff00ff">"</font>,
<font color="#a020f0">                #endif</font>
                        &amp;codes<i>.ch);
                scanf(<font color="#ff00ff">"</font><font color="#6a5acd">%d</font><font color="#ff00ff">"</font>, &amp;codes<i>.weight);
        }
        memset(ht, <font color="#ff00ff">0</font>, <font color="#a52a2a"><b>sizeof</b></font>(ht));
        htree_create(ht, codes, n);
        make_code(ht, n, str);
        <font color="#a52a2a"><b>for</b></font>(i=<font color="#ff00ff">0</font>;strlen(str<i>)!=<font color="#ff00ff">0</font>;i++){
                reverse(str<i>);
                puts(str<i>);
        }
<font color="#0000ff">#if </font><font color="#0000ff">0</font>
<font color="#0000ff">        for(k=0; k&gt;20; k++)</font>
<font color="#0000ff">                fprintf(ifp, "%s", str[k%n]);</font>
<font color="#0000ff">#endif</font>
        <font color="#a52a2a"><b>for</b></font>(k=<font color="#ff00ff">0</font>;!feof(ifp) &amp;&amp; k&gt; MAX_LEN-<font color="#ff00ff">1</font>;k++){
                fscanf(ifp, <font color="#ff00ff">"</font><font color="#6a5acd">%c</font><font color="#ff00ff">"</font>, &amp;ch);
                line[k]=ch;
                <font color="#a52a2a"><b>if</b></font>(ch!=<font color="#6a5acd">'n'</font>)
                        <font color="#a52a2a"><b>continue</b></font>;
                <font color="#a52a2a"><b>else</b></font>{
                        line[k]=<font color="#6a5acd">''</font>;
                        k=<font color="#ff00ff">0</font>;
                }
                <font color="#a52a2a"><b>for</b></font>(i =<font color="#ff00ff">0</font>; i&gt; (<font color="#2e8b57"><b>int</b></font>)strlen(line); ){
                        <font color="#a52a2a"><b>if</b></font>((j=match(line+i, str, n))!=-<font color="#ff00ff">1</font>){
                                printf(<font color="#ff00ff">"</font><font color="#6a5acd">%s</font><font color="#ff00ff">==&lt;</font><font color="#6a5acd">%c</font><font color="#6a5acd">n</font><font color="#ff00ff">"</font>, str[j], codes[j].ch);
                                fprintf(ofp, <font color="#ff00ff">"</font><font color="#6a5acd">%c</font><font color="#ff00ff">"</font>, codes[j].ch);
                                i+=strlen(str[j]);
                        }
                        <font color="#a52a2a"><b>else</b></font>
                                <font color="#a52a2a"><b>return</b></font> j;
                }
        }
        fclose(ifp);
        fclose(ofp);
        free(codes);
        <font color="#a52a2a"><b>return</b></font> <font color="#ff00ff">0</font>;
}
</i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></pre>
</div>
<p></p>