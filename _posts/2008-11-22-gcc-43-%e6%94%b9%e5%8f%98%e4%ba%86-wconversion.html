---
categories:
- Programming
date: 2008-11-22 00:06:51-08:00
layout: post
permalink: /2008/11/22/gcc-43-%e6%94%b9%e5%8f%98%e4%ba%86-wconversion/
title: gcc 4.3 改变了 -Wconversion
---
<p><br />
</p>
<p>gcc 4.3之前，-Wconversion是这样的：</p>
<blockquote><p>Warn if a prototype causes a type conversion that is different from what would<br />
happen to the same argument in the absence of a prototype.</p>
<p>Also, warn if a negative integer constant expression is implicitly converted to<br />
an unsigned type.</p></blockquote>
<p>到了4.3就变了，<a href="http://gcc.gnu.org/gcc-4.3/changes.html" target="_blank">发布日志</a>上解释到：</p>
<blockquote><p>The -Wconversion option has been modified. Its purpose now is to warn for<br />
implicit conversions that may alter a value. This new behavior is available for<br />
both C and C++. Warnings about conversions between signed and unsigned integers<br />
can be disabled by using -Wno-sign-conversion. In C++, they are disabled by<br />
default unless -Wsign-conversion is explicitly requested. The old behavior of<br />
-Wconversion, that is, warn for prototypes causing a type conversion that is<br />
different from what would happen to the same argument in the absence of a<br />
prototype, has been moved to a new option -Wtraditional-conversion, which is<br />
only available for C</p></blockquote>
<p>这个改变其实挺大的，下面通过这个程序就可以展示这个问题：</p>
<p>[c]<br />
void foo(short i);</p>
<p>void foo(short i)<br />
{<br />
	i++; //dummy<br />
}</p>
<p>int main(void)<br />
{<br />
	int a = 1;<br />
	short b =2;<br />
	b = a;<br />
	foo(a);<br />
	return 0;<br />
}<br />
[/c]</p>
<p>$ gcc -Wall -Wtraditional-conversion -o conv conv.c<br />
conv.c: In function ‘main’:<br />
conv.c:14: warning: passing argument 1 of ‘foo’ with different width due to prototype<br />
$ gcc -Wall -o conv conv.c<br />
$ gcc -Wall -Wconversion -o conv conv.c<br />
conv.c: In function ‘main’:<br />
conv.c:13: warning: conversion to ‘short int’ from ‘int’ may alter its value<br />
conv.c:14: warning: conversion to ‘short int’ from ‘int’ may alter its value</p>
<p></p>