---
layout: post
title: Linux内核中的几个概念
date: 2007-03-09 23:08:12.000000000 -08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Linux Kernel
tags: []
meta:
  _publicize_pending: '1'
  original_post_id: '49'
  _wp_old_slug: '49'
author:
  login: wangcong2015
  email: wangcong@rocketmail.com
  display_name: wangcong2015
  first_name: ''
  last_name: ''
permalink: "/2007/03/09/linux%e5%86%85%e6%a0%b8%e4%b8%ad%e7%9a%84%e5%87%a0%e4%b8%aa%e6%a6%82%e5%bf%b5-2/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<html><body></p>
<p class="postdate">Sunday, 25. February 2007, 07:19:10</p>
<p class="content">
<p align="right"><span class="alignright">王聪@西邮</span></p>
<p>软中断（softirq）是内核使用的一种推后执行任务的一种机制，由于一些中断处理必须要在短期内完成，所以内核不得不把一些相对不重要的工作推后执行，软中断就是专门用来执行这种后退的工作。它在某种程度上有点像硬件中断，来得“随时随地”，而且不在进程上下文之中。千万不要把它和“软件中断（software interrupts）”这个概念混了，后者是因为在编程中使用了中断指令（比如：int 0x80）而产生一个硬件上实际存在的中断信号，而前者更本就不和硬件扯关系。</p>
<p>小任务（tasklet）是在软中断的基础上实现的一种后推执行方式。软中断是在编译时就已经确定好的，而小任务则可以在运行时分配和初始化；软中断可以在不同的CPU上同时执行，而同一类型的tasklet只能在调度它们的同一CPU上运行，因此软中断函数必须是可重入的，而小任务的函数则没有这个必要。</p>
<p>工作队列（work queue）是另一种后推方式，但它和小任务有着很大的区别，小任务是在中断上下文中执行的，而工作队列是在进程上下文中执行的，所以工作队列是可以休眠的，也就不一定是原子的。执行工作队列的线程是ksoftirqd/n（n是cpu的编号，在UP是ksoftirqd/0），这是一个内核线程，因此也不能访问用户内存。</p>
<p>下半部（bottom half）是后推执行任务的一个统称，它主要是完成上半部未完成的一些工作。一般来说，在处理中断时，在中断处理例程（上半部）中做的工作越少越好，其余一些相对不那么迫切的工作可以后推给下半部来完成，当然了，下半部可以是小任务，也可以是工作队列。</body></html></p>
