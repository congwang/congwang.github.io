---
categories:
- Linux Application
date: 2011-11-10 16:43:50-08:00
layout: post
permalink: /2011/11/10/ping-%e7%9a%84-mdev-%e5%80%bc/
title: ping 的 mdev 值
---
<p><br />
</p>
<p>在运行 ping 命令的时候，里面有一项输出叫 mdev，如下所示：</p></p>
<div id="_mcePaste">~% ping www.google.pt</div>
<div id="_mcePaste">PING www.l.google.com (72.14.203.103) 56(84) bytes of data.</div>
<div id="_mcePaste">64 bytes from tx-in-f103.1e100.net (72.14.203.103): icmp_req=1 ttl=50 time=84.1 ms</div>
<div id="_mcePaste">64 bytes from tx-in-f103.1e100.net (72.14.203.103): icmp_req=2 ttl=50 time=83.0 ms</div>
<div id="_mcePaste">64 bytes from tx-in-f103.1e100.net (72.14.203.103): icmp_req=3 ttl=50 time=85.5 ms</div>
<div id="_mcePaste">^C</div>
<div id="_mcePaste">--- www.l.google.com ping statistics ---</div>
<div id="_mcePaste">3 packets transmitted, 3 received, 0% packet loss, time 2001ms</div>
<div id="_mcePaste">rtt min/avg/max/<strong>mdev</strong> = 83.019/84.227/85.506/1.016 ms</div>
<p>它是什么意思呢？ ping 的手册中并没有提到。我们不妨看一下 <a href="http://www.skbuff.net/iputils" target="_blank">ping 的源代码</a>，见 ping_common.c：</p>
<p>tsum += triptime;<br />
tsum2 += (long long)triptime * (long long)triptime</p>
<p>以及</p>
<p>tsum /= nreceived + nrepeats;<br />
tsum2 /= nreceived + nrepeats;<br />
tmdev = llsqrt(tsum2 - tsum * tsum);</p>
<p>所以我们可以得出：</p>
<p>mdev = SQRT(SUM(RTT*RTT) / N - (SUM(RTT)/N)^2)</p>
<p>也就是这个<span style="font-family:arial;line-height:20px;">平均偏差的</span>公式：</p>
<p style="text-align:center;"><a href="http://wangcong.org/blog/wp-content/uploads/2011/11/formula.png"><img class="size-full wp-image-1802  aligncenter" src="{{site.baseurl}}/assets/2011/11/formula.png" alt="" width="329" height="60"></a></p>
<p>所以 mdev 就是 Mean Deviation 的缩写，它表示这些 ICMP 包的 RTT 偏离平均值的程度，这个值越大说明你的网速越不稳定。</p>