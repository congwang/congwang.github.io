---
categories:
- Programming
date: 2007-12-09 15:05:16-08:00
layout: post
permalink: /2007/12/09/%e8%bf%99%e4%b8%8d%e6%98%afgcc%e7%9a%84bug/
title: 这不是gcc的bug
---
<p><br />
</p>
<p>一些人说，gcc可以安静地编译下面的程序：</p>
<pre>
void foo(void *p)
{
   ++p;
}</pre>
<p>所以这是gcc的一个bug。很不幸，这一个feature，而不是bug。gcc手册中明显地提到：</p>
<blockquote><p>In GNU C, addition and subtraction operations are supported on pointers<br />
to `void' and on pointers to functions.  This is done by treating the<br />
size of a `void' or of a function as 1.
</p></blockquote>
<p>如果你对此不满，那就打开-Wpointer-arith。（不过话说回来了，-Wall -W居然都不会打开这个选项～～）而Intel C编译器就可以给出警告：</p>
<pre>
foo.c(3): warning #1338: arithmetic on pointer to void or function type
     ++p;
     ^</pre>
<p>当然了，标准肯定是不允许对void*进行算术操作，原因很简单，因为它指向的对象大小不知道。参见C99 6.5.6。</p>