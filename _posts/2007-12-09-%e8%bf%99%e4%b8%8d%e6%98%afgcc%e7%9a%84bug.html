---
layout: post
title: 这不是gcc的bug
date: 2007-12-09 15:05:16.000000000 -08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Programming
tags: []
meta:
  _publicize_pending: '1'
  original_post_id: '273'
  _wp_old_slug: '273'
author:
  login: wangcong2015
  email: wangcong@rocketmail.com
  display_name: wangcong2015
  first_name: ''
  last_name: ''
permalink: "/2007/12/09/%e8%bf%99%e4%b8%8d%e6%98%afgcc%e7%9a%84bug/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<html><body></p>
<p>一些人说，gcc可以安静地编译下面的程序：</p>
<pre>
void foo(void *p)
{
   ++p;
}</pre>
<p>所以这是gcc的一个bug。很不幸，这一个feature，而不是bug。gcc手册中明显地提到：</p>
<blockquote><p>In GNU C, addition and subtraction operations are supported on pointers<br />
to `void' and on pointers to functions.  This is done by treating the<br />
size of a `void' or of a function as 1.
</p></blockquote>
<p>如果你对此不满，那就打开-Wpointer-arith。（不过话说回来了，-Wall -W居然都不会打开这个选项～～）而Intel C编译器就可以给出警告：</p>
<pre>
foo.c(3): warning #1338: arithmetic on pointer to void or function type
     ++p;
     ^</pre>
<p>当然了，标准肯定是不允许对void*进行算术操作，原因很简单，因为它指向的对象大小不知道。参见C99 6.5.6。</body></html></p>
